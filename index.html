<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Live Walk Overlay</title>

<style>
body{
margin:0;
background:transparent;
overflow:hidden;
font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial,sans-serif;
color:#fff;
}

/* overlay position */
.overlay{
position:fixed;
right:4vw;
bottom:4vh;
text-align:right;
pointer-events:none;
}

/* location text */
.place{
font-size:38px;
font-weight:400;
letter-spacing:2px;
text-transform:uppercase;
text-shadow:0 2px 10px rgba(0,0,0,.7),0 0 2px rgba(0,0,0,.9);
white-space:nowrap;
line-height:1.15;
opacity:0;
transition:opacity 1.2s ease;
}

/* temp + time */
.meta{
margin-top:.25vh;
font-size:32px;
font-weight:300;
opacity:.9;
text-shadow:0 2px 10px rgba(0,0,0,.7),0 0 2px rgba(0,0,0,.9);
white-space:nowrap;
}

/* slow fade divider */
.dot{
padding:0 6px;
animation:dotfade 4s ease-in-out infinite;
}

@keyframes dotfade{
0%{opacity:.2}
50%{opacity:1}
100%{opacity:.2}
}
</style>
</head>

<body>

<div class="overlay">
<div class="place" id="placeTop"></div>
<div class="place" id="place"></div>

<div class="meta">
<span id="temp">--°F</span>
<span class="dot">•</span>
<span id="time">--:--:--</span>
</div>
</div>

<script>

const GEO_OPTIONS={enableHighAccuracy:true,maximumAge:15000,timeout:15000}
const WEATHER_REFRESH_MS=300000
const GEO_REFRESH_MS=60000

let lastCoords=null
let lastTemp="--"

function updateClock(){
document.getElementById("time").textContent=
new Date().toLocaleTimeString([],{
hour:'numeric',
minute:'2-digit',
second:'2-digit'
})
}

setInterval(updateClock,1000)

function fadeText(id,text){
const el=document.getElementById(id)
el.style.opacity=0

setTimeout(()=>{
el.textContent=text
el.style.opacity=1
},250)
}

function normalizeState(state){
return state||""
}

function pickBestPlace(addr){

const feature=
addr.park||
addr.national_park||
addr.protected_area||
addr.nature_reserve||
addr.attraction||
addr.tourism||
addr.museum||
addr.zoo||
addr.aerodrome||
""

const neighborhood=
addr.neighbourhood||
addr.neighborhood||
addr.quarter||
addr.suburb||
addr.city_district||
addr.borough||
addr.district||
""

const city=
addr.city||
addr.town||
addr.village||
addr.hamlet||
""

const state=normalizeState(addr.state||addr.region||"")

let top=feature||neighborhood||""

let bottom=""
if(city&&state)bottom=`${city}, ${state}`
else if(city)bottom=city
else if(state)bottom=state
else bottom="Location"

if(top===city||top===state)top=""

return{top,bottom}
}

async function reverseGeocode(lat,lon){

try{

const res=await fetch(
`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}&zoom=16&addressdetails=1`
)

const data=await res.json()

const place=pickBestPlace(data.address||{})

if(place.top){
fadeText("placeTop",place.top)
document.getElementById("placeTop").style.display="block"
}
else{
document.getElementById("placeTop").style.display="none"
}

fadeText("place",place.bottom)

}catch{}
}

async function fetchWeather(lat,lon){

try{

const res=await fetch(
`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=fahrenheit`
)

const data=await res.json()

const t=Math.round(data.current_weather?.temperature)

if(Number.isFinite(t)){
lastTemp=t
document.getElementById("temp").textContent=`${t}°F`
}

}catch{}
}

async function refreshAll(lat,lon){

const moved=
!lastCoords||
Math.abs(lat-lastCoords.lat)>.002||
Math.abs(lon-lastCoords.lon)>.002

lastCoords={lat,lon}

fetchWeather(lat,lon)

if(moved){
reverseGeocode(lat,lon)
}

}

function startGPS(){

if(!navigator.geolocation){
fadeText("place","Enable Location")
return
}

const onPos=(pos)=>{
const lat=pos.coords.latitude
const lon=pos.coords.longitude
refreshAll(lat,lon)
}

navigator.geolocation.getCurrentPosition(onPos)
setInterval(()=>navigator.geolocation.getCurrentPosition(onPos),GEO_REFRESH_MS)

}

updateClock()
startGPS()

setInterval(()=>{
if(lastCoords)fetchWeather(lastCoords.lat,lastCoords.lon)
},WEATHER_REFRESH_MS)

</script>
</body>
</html>
